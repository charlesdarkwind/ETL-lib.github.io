<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ETL Library: ETL.curated_tables Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ETL Library
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespace_e_t_l.html">ETL</a></li><li class="navelem"><a class="el" href="namespace_e_t_l_1_1curated__tables.html">curated_tables</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">ETL.curated_tables Namespace Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a584c512f3ea3592b1aaa755b962f2ff8"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_e_t_l_1_1curated__tables.html#a584c512f3ea3592b1aaa755b962f2ff8">read</a> (config, table, incremental=False, **raw_dataframe_reader_options)</td></tr>
<tr class="separator:a584c512f3ea3592b1aaa755b962f2ff8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a258e97b5dc3791d8579ab27a2dd5ca2d"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_e_t_l_1_1curated__tables.html#a258e97b5dc3791d8579ab27a2dd5ca2d">write</a> (config, table, df=None, transformation=None, incremental=False, raw_dataframe_reader_options=None, **dataframe_writer_options)</td></tr>
<tr class="separator:a258e97b5dc3791d8579ab27a2dd5ca2d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a30afc3c3aca3346b37b8eb368f3b2cd7"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_e_t_l_1_1curated__tables.html#a30afc3c3aca3346b37b8eb368f3b2cd7">merge</a> (config, table, df=None, transformation=None, unique_key=None, incremental=False, raw_dataframe_reader_options=None)</td></tr>
<tr class="separator:a30afc3c3aca3346b37b8eb368f3b2cd7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac3019e182f1823acd72c35ab939c15cc"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_e_t_l_1_1curated__tables.html#ac3019e182f1823acd72c35ab939c15cc">delete</a> (config, table, drop=False)</td></tr>
<tr class="separator:ac3019e182f1823acd72c35ab939c15cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a3ea993aba95aa4fd78ef84091f132fbe"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_e_t_l_1_1curated__tables.html#a3ea993aba95aa4fd78ef84091f132fbe">upsert</a> = <a class="el" href="namespace_e_t_l_1_1curated__tables.html#a30afc3c3aca3346b37b8eb368f3b2cd7">merge</a></td></tr>
<tr class="separator:a3ea993aba95aa4fd78ef84091f132fbe"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><pre class="fragment">This module provides utility functions to select, insert and delete operations on delta tables from the curated zone.

The names and structure of tables, folders and paths must conform to the library's standard convention:

  - curated-zone -| - data_source - ...
            |
            |
            | - data_source - ...
            |
            |
            | - yammer -  | - table_name
                          | - table_name
                          | - Messages
                          | - Users
                          | - Likes</pre> </div><h2 class="groupheader">Function Documentation</h2>
<a id="ac3019e182f1823acd72c35ab939c15cc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac3019e182f1823acd72c35ab939c15cc">&#9670;&nbsp;</a></span>delete()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def ETL.curated_tables.delete </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>table</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>drop</em> = <code>False</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Delete delta data.

Only use drop when really needed, otherwise just overwrite or delete.

Parameters
----------
config: Config
  Config instance
table: str or list, optional
  Table name
  Leave empty to use all tables.
drop: bool, optional
  Drop table
</pre> 
</div>
</div>
<a id="a30afc3c3aca3346b37b8eb368f3b2cd7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a30afc3c3aca3346b37b8eb368f3b2cd7">&#9670;&nbsp;</a></span>merge()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def ETL.curated_tables.merge </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>table</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>df</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>transformation</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>unique_key</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>incremental</em> = <code>False</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>raw_dataframe_reader_options</em> = <code>None</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Update data in the delta table.

If df is not provided, read table data from raw.

Performs a 'merge into'/'upsert' of a dataframe/table-view inside the Delta Table.
Meaning rows are overwritten if it finds one with the same designated unqique fields, or else it is inserted.
The batch of updates must not contain more than one row with the same chosen unique key.

Handles the creation of the SQL condition update part. Needs an unique key, can be a combination of 2 or more fields.
Eg. "ON delta_messages.message_id = updates.message_id AND delta_messages.id = updates.id"

Parameters
----------
config: Config
  Config instance
table: str
  Name of the table / folder.
df: pyspark.sql.DataFrame, optional
  Dataframe containing the data to save in the curated delta table.
transformation: (pyspark.sql.DataFrame) -&gt; pyspark.sql.DataFrame, optional
  A function taking a df and returning a df.
unique_key: list or str, optional
  Columns with unique values or list of columns to use as a combined unique key.
incremental: bool, optional
  To perform incremental load based on the raw-zone's control table content.
raw_dataframe_reader_options: dict, optional
  If df is not None, options are used when reading raw zone files.
</pre> 
</div>
</div>
<a id="a584c512f3ea3592b1aaa755b962f2ff8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a584c512f3ea3592b1aaa755b962f2ff8">&#9670;&nbsp;</a></span>read()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def ETL.curated_tables.read </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>table</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>incremental</em> = <code>False</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">**&#160;</td>
          <td class="paramname"><em>raw_dataframe_reader_options</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Read all data, equivalent of doing a "SELECT *"

Returns None if no data at path or path does not exists.
Can still return a empty dataframe or a dataframe of empty rows if such is obtained from reading the files.

Parameters
----------
config: Config
table: str
incremental: bool
  To perform incremental read based on the raw-zone's control table content.
raw_dataframe_reader_options: dict, optional
  If df is not None, options are used when reading raw
raw_dataframe_reader_options

Returns
-------
pyspark.sql.DataFrame
</pre> 
</div>
</div>
<a id="a258e97b5dc3791d8579ab27a2dd5ca2d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a258e97b5dc3791d8579ab27a2dd5ca2d">&#9670;&nbsp;</a></span>write()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def ETL.curated_tables.write </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>table</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>df</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>transformation</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>incremental</em> = <code>False</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>raw_dataframe_reader_options</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">**&#160;</td>
          <td class="paramname"><em>dataframe_writer_options</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Write/save data in the delta table.

Parameters
----------
config: Config
  Config instance
table: str
  Name of the table / folder.
df: pyspark.sql.DataFrame, optional
  Dataframe containing the data to save in the curated delta table.
transformation: (pyspark.sql.DataFrame) -&gt; pyspark.sql.DataFrame, optional
  A function taking a df and returning a df.
incremental: bool, optional
  To perform incremental load based on the raw-zone's control table content.
raw_dataframe_reader_options: dict, optional
  If df is not None, options are used when reading raw zone files.
dataframe_writer_options:
    mode: str
        'overwrite' or 'append'
</pre> 
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a3ea993aba95aa4fd78ef84091f132fbe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3ea993aba95aa4fd78ef84091f132fbe">&#9670;&nbsp;</a></span>upsert</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def ETL.curated_tables.upsert = <a class="el" href="namespace_e_t_l_1_1curated__tables.html#a30afc3c3aca3346b37b8eb368f3b2cd7">merge</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
